---
title: Jak zapytania praca - programu EF Core
author: rowanmiller
ms.date: 09/26/2018
ms.assetid: de2e34cd-659b-4cab-b5ed-7a979c6bf120
uid: core/querying/overview
ms.openlocfilehash: 23d26f9c0ac17fc0df744f5339946947ea366911
ms.sourcegitcommit: 15022dd06d919c29b1189c82611ea32f9fdc6617
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/27/2018
ms.locfileid: "47415734"
---
# <a name="how-queries-work"></a><span data-ttu-id="f410f-102">Jak działają zapytań</span><span class="sxs-lookup"><span data-stu-id="f410f-102">How Queries Work</span></span>

<span data-ttu-id="f410f-103">Entity Framework Core używa Language Integrated Query (LINQ) do zapytania o dane z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f410f-103">Entity Framework Core uses Language Integrated Query (LINQ) to query data from the database.</span></span> <span data-ttu-id="f410f-104">LINQ umożliwia przy użyciu języka C# (lub wybranym języku .NET) do pisania zapytań silnie typizowaną oparte na klasach pochodnych kontekstu i jednostki.</span><span class="sxs-lookup"><span data-stu-id="f410f-104">LINQ allows you to use C# (or your .NET language of choice) to write strongly typed queries based on your derived context and entity classes.</span></span>

## <a name="the-life-of-a-query"></a><span data-ttu-id="f410f-105">Czas życia zapytania</span><span class="sxs-lookup"><span data-stu-id="f410f-105">The life of a query</span></span>

<span data-ttu-id="f410f-106">Poniżej znajduje się przegląd wysokiego poziomu procesu, który przechodzi każdego zapytania.</span><span class="sxs-lookup"><span data-stu-id="f410f-106">The following is a high level overview of the process each query goes through.</span></span>

1. <span data-ttu-id="f410f-107">Zapytania LINQ są przetwarzane przez program Entity Framework Core do budowania reprezentacji, które jest gotowe do przetworzenia przez dostawcę bazy danych</span><span class="sxs-lookup"><span data-stu-id="f410f-107">The LINQ query is processed by Entity Framework Core to build a representation that is ready to be processed by the database provider</span></span>
   1. <span data-ttu-id="f410f-108">Wynik jest buforowany, dzięki czemu to przetwarzanie nie musi odbywać się za każdym razem, gdy zapytanie jest wykonywane</span><span class="sxs-lookup"><span data-stu-id="f410f-108">The result is cached so that this processing does not need to be done every time the query is executed</span></span>
2. <span data-ttu-id="f410f-109">Wynik jest przekazywany do dostawcy bazy danych</span><span class="sxs-lookup"><span data-stu-id="f410f-109">The result is passed to the database provider</span></span>
   1. <span data-ttu-id="f410f-110">Dostawca bazy danych identyfikuje części zapytania, które mogą być obliczane w bazie danych</span><span class="sxs-lookup"><span data-stu-id="f410f-110">The database provider identifies which parts of the query can be evaluated in the database</span></span>
   2. <span data-ttu-id="f410f-111">Te części zapytania są tłumaczone na języka użytego zapytania bazy danych (na przykład SQL dla relacyjnej bazy danych)</span><span class="sxs-lookup"><span data-stu-id="f410f-111">These parts of the query are translated to database specific query language (for example, SQL for a relational database)</span></span>
   3. <span data-ttu-id="f410f-112">Co najmniej jeden zapytania są wysyłane do bazy danych i zwróconym zestawie wyników (wyniki są wartości z bazy danych, a nie wystąpień jednostek)</span><span class="sxs-lookup"><span data-stu-id="f410f-112">One or more queries are sent to the database and the result set returned (results are values from the database, not entity instances)</span></span>
3. <span data-ttu-id="f410f-113">Dla każdego elementu w zestawie wyników</span><span class="sxs-lookup"><span data-stu-id="f410f-113">For each item in the result set</span></span>
   1. <span data-ttu-id="f410f-114">Jeśli jest to zapytania śledzenia, EF sprawdza, czy dane reprezentuje jednostkę już w śledzenie zmian dla wystąpienia kontekstu</span><span class="sxs-lookup"><span data-stu-id="f410f-114">If this is a tracking query, EF checks if the data represents an entity already in the change tracker for the context instance</span></span>
      * <span data-ttu-id="f410f-115">Jeśli tak, zwracany jest istniejąca jednostka</span><span class="sxs-lookup"><span data-stu-id="f410f-115">If so, the existing entity is returned</span></span>
      * <span data-ttu-id="f410f-116">W przeciwnym razie jest tworzona nowa jednostka skonfigurowano śledzenie zmian i zwracany jest nowa jednostka</span><span class="sxs-lookup"><span data-stu-id="f410f-116">If not, a new entity is created, change tracking is setup, and the new entity is returned</span></span>
   2. <span data-ttu-id="f410f-117">Jeśli zapytania śledzenia nie EF sprawdza, czy dane reprezentuje jednostkę już w zestawu wyników dla tego zapytania</span><span class="sxs-lookup"><span data-stu-id="f410f-117">If this is a no-tracking query, EF checks if the data represents an entity already in the result set for this query</span></span>
      * <span data-ttu-id="f410f-118">Jeśli tak, jest zwracana istniejącej jednostki <sup>(1)</sup></span><span class="sxs-lookup"><span data-stu-id="f410f-118">If so, the existing entity is returned <sup>(1)</sup></span></span>
      * <span data-ttu-id="f410f-119">Jeśli nie, nowy obiekt jest tworzony i zwracany</span><span class="sxs-lookup"><span data-stu-id="f410f-119">If not, a new entity is created and returned</span></span>

<span data-ttu-id="f410f-120"><sup>(1) </sup> Nie śledzenia zapytań za pomocą słabe odwołania do śledzenie jednostek, które już zostały zwrócone.</span><span class="sxs-lookup"><span data-stu-id="f410f-120"><sup>(1)</sup> No tracking queries use weak references to keep track of entities that have already been returned.</span></span> <span data-ttu-id="f410f-121">Jeśli poprzedni wynik z tą samą tożsamością wykracza poza zakres, a następnie uruchamia wyrzucanie elementów bezużytecznych, może pojawić się nowe wystąpienie jednostki.</span><span class="sxs-lookup"><span data-stu-id="f410f-121">If a previous result with the same identity goes out of scope, and garbage collection runs, you may get a new entity instance.</span></span>

## <a name="when-queries-are-executed"></a><span data-ttu-id="f410f-122">Gdy zapytania są wykonywane.</span><span class="sxs-lookup"><span data-stu-id="f410f-122">When queries are executed</span></span>

<span data-ttu-id="f410f-123">Po wywołaniu operatorów LINQ, są po prostu budowania reprezentacji w pamięci, zapytania.</span><span class="sxs-lookup"><span data-stu-id="f410f-123">When you call LINQ operators, you are simply building up an in-memory representation of the query.</span></span> <span data-ttu-id="f410f-124">Zapytanie jest wysyłane do bazy danych tylko wtedy, gdy wyniki są używane.</span><span class="sxs-lookup"><span data-stu-id="f410f-124">The query is only sent to the database when the results are consumed.</span></span>

<span data-ttu-id="f410f-125">Najbardziej typowe operacje, których wynikiem zapytania są wysyłane do bazy danych są:</span><span class="sxs-lookup"><span data-stu-id="f410f-125">The most common operations that result in the query being sent to the database are:</span></span>
* <span data-ttu-id="f410f-126">Iteracja wyniki w parametrze `for` pętli</span><span class="sxs-lookup"><span data-stu-id="f410f-126">Iterating the results in a `for` loop</span></span>
* <span data-ttu-id="f410f-127">Przy użyciu operatora, takich jak `ToList`, `ToArray`, `Single`, `Count`</span><span class="sxs-lookup"><span data-stu-id="f410f-127">Using an operator such as `ToList`, `ToArray`, `Single`, `Count`</span></span>
* <span data-ttu-id="f410f-128">Powiązanie danych z wynikami zapytania do interfejsu użytkownika</span><span class="sxs-lookup"><span data-stu-id="f410f-128">Databinding the results of a query to a UI</span></span>

> [!WARNING]  
> <span data-ttu-id="f410f-129">**Zawsze weryfikowały dane wejściowe użytkownika:** podczas EF Core chroni przed atakami polegającymi na iniekcji SQL przy użyciu parametrów i anulowania zapewnianego element literałów w zapytaniach, go nie sprawdza poprawność danych wejściowych.</span><span class="sxs-lookup"><span data-stu-id="f410f-129">**Always validate user input:** While EF Core protects against SQL injection attacks by using parameters and escaping literals in queries, it does not validate inputs.</span></span> <span data-ttu-id="f410f-130">Weryfikacji odpowiednią dla wymagań aplikacji należy wykonać przed wartości ze źródeł niezaufanych są używane w kwerendach LINQ, przypisany do właściwości jednostki lub przekazywane do innych interfejsów EF Core API.</span><span class="sxs-lookup"><span data-stu-id="f410f-130">Appropriate validation, per the application's requirements, should be performed before values from untrusted sources are used in LINQ queries, assigned to entity properties, or passed to other EF Core APIs.</span></span> <span data-ttu-id="f410f-131">Dotyczy to danych podawanych przez użytkownika używane do dynamicznego utworzenia kwerendy.</span><span class="sxs-lookup"><span data-stu-id="f410f-131">This includes any user input used to dynamically construct queries.</span></span> <span data-ttu-id="f410f-132">Nawet wtedy, gdy za pomocą LINQ, jeśli użytkownik akceptuje dane wejściowe użytkownika, aby zbudować wyrażenia, należy się upewnić, że można konstruować tylko wyrażenia zamierzone.</span><span class="sxs-lookup"><span data-stu-id="f410f-132">Even when using LINQ, if you are accepting user input to build expressions, you need to make sure that only intended expressions can be constructed.</span></span>
